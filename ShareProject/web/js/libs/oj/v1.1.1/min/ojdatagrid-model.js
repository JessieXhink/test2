/**
 * Copyright (c) 2014, 2015, Oracle and/or its affiliates.
 * All rights reserved.
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojdatacollection-common","ojs/ojmodel"],function(a){a.td=function(f,d,b,c,e){a.j.pc(f,null);a.j.pc(d,null);a.j.pc(b,null);a.j.pc(c,null);a.j.Xv(e);this.$h=f;this.wp=d;this.ak=b;this.vp=c;this.Fd=e};o_("CollectionCellSet",a.td,a);a.td.prototype.p_=function(f){a.j.cB(f);null!=f&&f.length===this.Q("row")&&(this.zp=f)};a.td.prototype.getData=function(a){var d;d=this.Hb(a);return null==d?null:d.get(this.Fd[a.column])};a.b.i("CollectionCellSet.prototype.getData",{getData:a.td.prototype.getData});
a.td.prototype.getMetadata=function(f){var d;d=this.Hb(f);return null==d?null:{keys:{row:a.Hn.Vq(d),column:this.Fd[f.column]}}};a.b.i("CollectionCellSet.prototype.getMetadata",{getMetadata:a.td.prototype.getMetadata});a.td.prototype.Hb=function(f){var d;if(null==this.zp)return null;a.j.ie(f);d=f.row;f=f.column;a.j.assert(d>=this.$h&&d<=this.wp&&f>=this.ak&&f<=this.vp);return this.zp[d-this.$h]};a.td.prototype.Q=function(a){return"row"===a?Math.max(0,this.wp-this.$h):"column"===a?Math.max(0,this.vp-
this.ak):0};a.b.i("CollectionCellSet.prototype.getCount",{Q:a.td.prototype.Q});a.td.prototype.getStartRow=function(){return this.$h};a.b.i("CollectionCellSet.prototype.getStartRow",{getStartRow:a.td.prototype.getStartRow});a.td.prototype.nY=function(){return this.wp};a.b.i("CollectionCellSet.prototype.getEndRow",{nY:a.td.prototype.nY});a.td.prototype.getStartColumn=function(){return this.ak};a.b.i("CollectionCellSet.prototype.getStartColumn",{getStartColumn:a.td.prototype.getStartColumn});a.td.prototype.mY=
function(){return this.vp};a.b.i("CollectionCellSet.prototype.getEndColumn",{mY:a.td.prototype.mY});a.td.prototype.gn=function(){return this.Fd};a.b.i("CollectionCellSet.prototype.getColumns",{gn:a.td.prototype.gn});a.Hn=function(){};a.Hn.Vq=function(a){var d;d=a.Bf();null==d&&(d=a.Ln());return d};a.Hc=function(f,d,b,c){a.j.pc(f,null);a.j.pc(d,null);a.j.Xv(b);this.ec=f;this.Ud=d;this.FB=b;this.Yf=c};o_("CollectionHeaderSet",a.Hc,a);a.Hc.prototype.p_=function(f){a.j.cB(f);null!=f&&f.length===this.Q()&&
(this.zp=f)};a.Hc.prototype.getData=function(f,d){var b;a.j.assert(f<=this.Ud&&f>=this.ec,"index out of bounds");a.j.assert(null==d||0==d,"level out of bounds");if(null!=this.Yf){if(null==this.zp)return null;b=this.zp[f-this.ec];return b.get(this.Yf)}return this.FB[f]};a.b.i("CollectionHeaderSet.prototype.getData",{getData:a.Hc.prototype.getData});a.Hc.prototype.getMetadata=function(f,d){var b;a.j.assert(f<=this.Ud&&f>=this.ec,"index out of bounds");a.j.assert(null==d||0==d,"level out of bounds");
if(null!=this.Yf){if(null==this.zp)return null;b=this.zp[f-this.ec];return{key:a.Hn.Vq(b)}}return{key:this.getData(f,d)}};a.b.i("CollectionHeaderSet.prototype.getMetadata",{getMetadata:a.Hc.prototype.getMetadata});a.Hc.prototype.Uf=function(){return 0<this.Q()?1:0};a.b.i("CollectionHeaderSet.prototype.getLevelCount",{Uf:a.Hc.prototype.Uf});a.Hc.prototype.Rb=function(f,d){a.j.assert(f<=this.Ud&&f>=this.ec,"index out of bounds");a.j.assert(null==d||0==d,"level out of bounds");return{extent:1,more:{before:!1,
after:!1}}};a.b.i("CollectionHeaderSet.prototype.getExtent",{Rb:a.Hc.prototype.Rb});a.Hc.prototype.Td=function(f,d){a.j.assert(f<=this.Ud&&f>=this.ec,"index out of bounds");a.j.assert(null==d||0==d,"level out of bounds");return 1};a.b.i("CollectionHeaderSet.prototype.getDepth",{Td:a.Hc.prototype.Td});a.Hc.prototype.Q=function(){return Math.max(0,this.Ud-this.ec)};a.b.i("CollectionHeaderSet.prototype.getCount",{Q:a.Hc.prototype.Q});a.Hc.prototype.ua=function(){return this.ec};a.b.i("CollectionHeaderSet.prototype.getStart",
{ua:a.Hc.prototype.ua});a.Hc.prototype.lY=function(){return this.Ud};a.b.i("CollectionHeaderSet.prototype.getEnd",{lY:a.Hc.prototype.lY});a.Hc.prototype.tY=function(){return this.FB};a.b.i("CollectionHeaderSet.prototype.getHeaders",{tY:a.Hc.prototype.tY});a.Hc.prototype.kw=function(){return this.Yf};a.b.i("CollectionHeaderSet.prototype.getRowHeader",{kw:a.Hc.prototype.kw});a.ya=function(f,d){this.Ea=f;null!=d&&(this.Qw=d.rowHeader,this.columns=d.columns);a.ya.q.constructor.call(this)};o_("CollectionDataGridDataSource",
a.ya,a);a.b.ga(a.ya,a.fc,"oj.CollectionDataGridDataSource");a.ya.prototype.Init=function(){a.ya.q.Init.call(this);this.Cl={};this.OH()};a.b.i("CollectionDataGridDataSource.prototype.Init",{Init:a.ya.prototype.Init});a.ya.prototype.OH=function(){this.Ea.on("add",this.G9.bind(this));this.Ea.on("remove",this.I9.bind(this));this.Ea.on("change",this.H9.bind(this));this.Ea.on("refresh",this.a9.bind(this));this.Ea.on("reset",this.b9.bind(this))};a.ya.prototype.$$=function(){return null!=this.data};a.ya.prototype.Q=
function(a){var d;void 0==this.precision&&(this.precision={});if("row"==a){d=this.Qd();if(-1===d||0===d&&(!this.$$()||0<this.Mi()))return this.precision[a]="estimate",-1;this.precision[a]="exact";return this.Mi()}if("column"==a){if(null!=this.columns)return this.precision[a]="exact",this.columns.length;this.precision[a]="estimate";return-1}return 0};a.b.i("CollectionDataGridDataSource.prototype.getCount",{Q:a.ya.prototype.Q});a.ya.prototype.Rf=function(a){null!=this.precision&&null!=this.precision[a]||
this.Q(a);return this.precision[a]};a.b.i("CollectionDataGridDataSource.prototype.getCountPrecision",{Rf:a.ya.prototype.Rf});a.ya.prototype.Sd=function(a,d,b){var c,e;null!=d&&(c=a.axis,e={},e.WY=a,e.callbacks=d,e.Zv=b,this.Cl[c]=e)};a.b.i("CollectionDataGridDataSource.prototype.fetchHeaders",{Sd:a.ya.prototype.Sd});a.ya.prototype.u9=function(f,d,b,c){var e,g,h,k;e=f.axis;g=f.start;h=f.count;a.j.assert("row"===e||"column"===e);a.j.assert(0<h);if("column"===e)null!=this.columns?(c=Math.min(this.columns.length,
g+h),k=new a.Hc(g,c,this.columns)):k=new a.sd(g,g,e,null);else if("row"===e){if(null!=this.Qw){null!=c&&(h=c.count);c=Math.min(this.Mi(),g+h);k=new a.Hc(g,c,this.columns,this.Qw);this.qV(g,c,k,f,d,b);return}k=new a.sd(g,g,e,null)}null!=d&&d.success&&d.success.call(b.success,k,f)};a.ya.prototype.NR=function(f){var d,b,c,e,g,h;for(d=0;d<f.length;d+=1)b=f[d],a.j.assert("row"===b.axis||"column"===b.axis),a.j.assert(0<b.count),"row"===b.axis?(c=b.start,e=b.count):"column"===b.axis&&(g=b.start,h=b.count);
return{rowStart:c,rowCount:e,colStart:g,colCount:h}};a.ya.prototype.T8=function(f,d,b,c){var e,g,h;e=this.NR(f);g=e.rowStart;c=null!=c?Math.min(this.Mi(),g+c.count):Math.min(this.Mi(),g+e.rowCount);h=e.colStart;e=Math.min(null==this.columns?0:this.columns.length,h+e.colCount);e=new a.td(g,c,h,e,this.columns);this.qV(g,c,e,f,d,b)};a.ya.prototype.qV=function(a,d,b,c,e,g){var h;for(h=[];a<d;a++)h.push(this.Ea.at(a,{deferred:!0}));Promise.all(h).then(function(a){b.p_(a);e.success.call(g.success,b,c)})};
a.ya.prototype.ke=function(a,d,b){null!=d&&(this.Zf={},this.Zf.vX=a,this.Zf.callbacks=d,this.Zf.Zv=b);this.T6(a)};a.b.i("CollectionDataGridDataSource.prototype.fetchCells",{ke:a.ya.prototype.ke});a.ya.prototype.wU=function(a){var d,b,c,e,g;d=this.Cl[a];null!=d&&(b=d.WY,c=d.callbacks,e=d.Zv,"row"===a&&(g=d.cJ),this.u9(b,c,e,g),this.Cl[a]=null)};a.ya.prototype.Jba=function(){this.T8(this.Zf.vX,this.Zf.callbacks,this.Zf.Zv,this.Zf.cJ)};a.ya.prototype.T6=function(a){var d;a=this.NR(a);d=a.rowStart;this.Ea.Rw(d,
a.rowCount).then(function(a){this.data=!0;var c=this.Ea.at(d,{deferred:!0});this.Yca(a.start,a.count);null!=c&&void 0===this.columns?c.then(function(a){this.kI(a);this.AQ()}.bind(this)):this.AQ()}.bind(this),function(a){this.U6(a)}.bind(this))};a.ya.prototype.U6=function(f){a.u.error(f);null!=this.Cl&&(this.xU("column",f),this.xU("row",f));null!=this.Zf&&this.Kba(f)};a.ya.prototype.xU=function(a,d){var b,c,e;b=this.Cl[a];null!=b&&(c=b.callbacks,e=b.Zv,b=b.WY,c.error&&c.error.call(e.error,d,b),this.Cl[a]=
null)};a.ya.prototype.Kba=function(a){var d,b,c;d=this.Zf.callbacks;b=this.Zf.Zv;c=this.Zf.vX;d.error&&d.error.call(b.error,a,c);this.Zf=null};a.ya.prototype.AQ=function(){null!=this.Cl&&(this.wU("column"),this.wU("row"));null!=this.Zf&&this.Jba()};a.ya.prototype.Yca=function(a,d){var b={start:a,count:d};null!=this.Cl.row&&(this.Cl.row.cJ=b);null!=this.Zf&&(this.Zf.cJ=b)};a.ya.prototype.kI=function(a){this.columns=a.keys();-1!=this.columns.indexOf(this.Qw)&&this.columns.splice(this.columns.indexOf(this.Qw),
1)};a.ya.prototype.keys=function(f){var d,b,c,e,g,h;d=f.row;b=f.column;h=this;return new Promise(function(f){g=h.Ea.at(d,{deferred:!0});null!=g?g.then(function(d){c=a.Hn.Vq(d);null==h.columns&&h.kI(d);e=h.columns[b];f({row:null==c?null:c,column:null==e?null:e})}.bind(h)):f({row:null,column:null})})};a.b.i("CollectionDataGridDataSource.prototype.keys",{keys:a.ya.prototype.keys});a.ya.prototype.oe=function(a){var d,b,c,e;d=a.row;b=a.column;e=this;return new Promise(function(a){e.Ea.indexOf(d,{deferred:!0}).then(function(d){null==
e.columns?e.Ea.first(1,{deferred:!0}).then(function(f){e.kI(f);c=e.columns.indexOf(b);a({row:d,column:c})}.bind(e)):(c=e.columns.indexOf(b),a({row:d,column:c}))}.bind(e))})};a.b.i("CollectionDataGridDataSource.prototype.indexes",{oe:a.ya.prototype.oe});a.ya.prototype.getCapability=function(a){return"sort"===a?"column":"move"===a?"row":null};a.b.i("CollectionDataGridDataSource.prototype.getCapability",{getCapability:a.ya.prototype.getCapability});a.ya.prototype.sort=function(a,d,b){var c,e,g;null==
b&&(b={});null==a?this.XH(d,b):(e=a.direction,g=a.key,a=a.axis,"column"===a?(this.Ea.$a()?(this.Ea.comparator=g,this.Ea.sortDirection="ascending"===e?1:-1):("ascending"===e&&(c=function(a,b){var c,d;a=a.get(g);b=b.get(g);c=isNaN(a);d=isNaN(b);a instanceof Date&&(a=a.toISOString(),c=!0);b instanceof Date&&(b=b.toISOString(),d=!0);return c&&d?a<b?-1:a===b?0:1:c?1:d?-1:a-b}),"descending"===e&&(c=function(a,b){var c,d;a=a.get(g);b=b.get(g);c=isNaN(a);d=isNaN(b);a instanceof Date&&(a=a.toISOString());
b instanceof Date&&(b=b.toISOString());return c&&d?a>b?-1:a===b?0:1:c?-1:d?1:b-a}),this.Ea.comparator=c),this.Ea.sort(),null!=d&&null!=d.success&&d.success.call(b.success)):null!=d&&null!=d.error&&d.error.call(b.error,"Axis value not supported"))};a.b.i("CollectionDataGridDataSource.prototype.sort",{sort:a.ya.prototype.sort});a.ya.prototype.XH=function(a,d){this.Ea.comparator=null;this.Ea.reset();null!=a&&null!=a.success&&a.success.call(d.success)};a.ya.prototype.move=function(a,d,b,c,e){var g;this.Ea.get(a,
{deferred:!0}).then(function(b){null==d?(this.Ea.remove(b),this.Ea.add(b),null!=c&&null!=c.success&&c.success.call(e.success)):(a===d?(g=this.Ea.indexOf(d,{deferred:!0}),this.Ea.remove(b)):(this.Ea.remove(b),g=this.Ea.indexOf(d,{deferred:!0})),g.then(function(a){this.Ea.add(b,{at:a,Jia:!0});null!=c&&null!=c.success&&c.success.call(e.success)}.bind(this)))}.bind(this))};a.b.i("CollectionDataGridDataSource.prototype.move",{move:a.ya.prototype.move});a.ya.prototype.Cj=function(a,d,b,c,e){var g={source:this};
g.operation=a;g.keys={row:d,column:b};g.indexes={row:c,column:e};return g};a.ya.prototype.G9=function(f){var d,b;this.Ea.indexOf(f,{deferred:!0}).then(function(c){b=a.Hn.Vq(f);d=this.Cj("insert",b,null,c,-1);this.handleEvent("change",d)}.bind(this))};a.ya.prototype.I9=function(f,d,b){this.handleEvent("change",this.Cj("delete",a.Hn.Vq(f),null,b.index,-1))};a.ya.prototype.H9=function(f){var d,b;this.Ea.indexOf(f,{deferred:!0}).then(function(c){b=a.Hn.Vq(f);d=this.Cj("update",b,null,c,-1);this.handleEvent("change",
d)}.bind(this))};a.ya.prototype.a9=function(){this.data=null;this.handleEvent("change",this.Cj("refresh",null,null))};a.ya.prototype.b9=function(){this.data=null;this.handleEvent("change",this.Cj("reset",null,null))};a.ya.prototype.Mi=function(){return this.Ea.size()};a.ya.prototype.Qd=function(){return void 0===this.Ea.totalResults?-1:this.Ea.totalResults};a.ya.prototype.gY=function(){return this.Ea};a.b.i("CollectionDataGridDataSource.prototype.getCollection",{gY:a.ya.prototype.gY});a.ya.prototype.gn=
function(){return this.columns};a.b.i("CollectionDataGridDataSource.prototype.getColumns",{gn:a.ya.prototype.gn});a.ya.prototype.kw=function(){return this.Qw};a.b.i("CollectionDataGridDataSource.prototype.getRowHeader",{kw:a.ya.prototype.kw});a.ya.prototype.getData=function(){return this.data};a.b.i("CollectionDataGridDataSource.prototype.getData",{getData:a.ya.prototype.getData})});