/**
 * Copyright (c) 2014, 2015, Oracle and/or its affiliates.
 * All rights reserved.
 */
"use strict";
define(["ojs/ojcore","jquery","hammerjs","promise","ojs/ojjquery-hammer","ojs/ojcomponentcore"],function(a,f,d){a.U={};o_("OffcanvasUtils",a.U,a);a.U.BM="oj-offcanvasEdge";a.U.$p="oj-offcanvas";a.U.ZC="oj-mediaQueryListener";a.U.CM="oj-offcanvasHammer";a.U.Fda={start:"oj-offcanvas-shift-start",end:"oj-offcanvas-shift-end",top:"oj-offcanvas-shift-down",bottom:"oj-offcanvas-shift-up"};a.U.G6={start:"oj-offcanvas-start",end:"oj-offcanvas-end",top:"oj-offcanvas-top",bottom:"oj-offcanvas-bottom"};a.U.Cm=
function(a){return a.hasClass("oj-offcanvas-open")};a.U.IR=function(a){return a.closest(".oj-offcanvas-outer-wrapper")};a.U.vF=function(a){var c=f(a.selector);return"push"===a.displayMode?c.parent():c};a.U.VR=function(b){var c=a.U.Fda[b];if(!c)throw"Invalid edge: "+b;return c};a.U.Ke=function(){return"rtl"===a.C.ns()};a.U.iI=function(a,c){a.css({"-webkit-transform":c,"-ms-transform":c,transform:c})};a.U.vda=function(b,c,d){c="end"===c;a.U.Ke()&&(c=!c);a.U.iI(b,"translate3d("+(c?"-":"")+d+", 0, 0)")};
a.U.wda=function(b,c,d){a.U.iI(b,"translate3d(0, "+("bottom"===c?"-":"")+d+", 0)")};a.U.uV=function(b){var c=b.edge;b=f(b.selector);c&&c.length||(c=b.hasClass("oj-offcanvas-start")?"start":b.hasClass("oj-offcanvas-end")?"end":b.hasClass("oj-offcanvas-top")?"top":b.hasClass("oj-offcanvas-bottom")?"bottom":"start");f.data(b[0],a.U.BM,c);return c};a.U.EF=function(b){return f.data(b[0],a.U.BM)};a.U.NW=function(a,c,d){var g=a.displayMode,h=f(a.selector),g="overlay"===g?"oj-offcanvas-transition oj-offcanvas-overlay":
"oj-offcanvas-transition";d?(d=h.attr("tabIndex"),void 0!==d&&(a.tabIndex=d),h.addClass("oj-offcanvas-open").attr("tabIndex","-1"),c.addClass(g)):(d=a.tabIndex,void 0===d?h.removeAttr("tabIndex"):h.attr("tabIndex",d),h.removeClass("oj-offcanvas-open"),c.removeClass(g))};a.U.X$=function(a){return"none"!=a.autoDismiss};a.U.fU=function(a,c){function d(){c();a.off("transitionend webkitTransitionEnd otransitionend oTransitionEnd",d)}a.on("transitionend webkitTransitionEnd otransitionend oTransitionEnd",
d)};a.U.cca=function(b){a.U.VW(b);if(a.U.X$(b)){var c=f(b.selector),d=b.dismisHandler=function(d){var e=d.target;a.C.eZ(d)||"focus"===d.type&&!f(e).is(":focusable")||a.C.Aga(c[0],e)||a.U.close(b)},g=document.documentElement;a.C.sf()&&g.addEventListener("touchstart",d,!0);g.addEventListener("mousedown",d,!0);g.addEventListener("focus",d,!0)}a.U.nA(b)};a.U.VW=function(b){var c=b.dismisHandler;if(c){var d=document.documentElement;a.C.sf()&&d.removeEventListener("touchstart",c,!0);d.removeEventListener("mousedown",
c,!0);d.removeEventListener("focus",c,!0);delete b.dismisHandler;b.dismisHandler=null}a.U.PA(b)};a.U.nA=function(b){if(a.C.sf()){var c=b.selector,e=f(c),g=a.U.EF(e),h,k;"start"==g&&!a.U.Ke()||"end"==g&&a.U.Ke()?(k={recognizers:[[d.Swipe,{direction:d.DIRECTION_LEFT}]]},h="swipeleft"):"start"==g&&a.U.Ke()||"end"==g&&!a.U.Ke()?(k={recognizers:[[d.Swipe,{direction:d.DIRECTION_RIGHT}]]},h="swiperight"):"top"==g?(k={recognizers:[[d.Swipe,{direction:d.DIRECTION_UP}]]},h="swipeup"):"bottom"==g&&(k={recognizers:[[d.Swipe,
{direction:d.DIRECTION_DOWN}]]},h="swipedown");e=e.un(k).on(h,function(c){c.preventDefault();a.U.close(b)});f.data(f(c)[0],a.U.CM,{event:h,hammer:e})}};a.U.PA=function(b){b=f(b.selector);(b=f.data(b[0],a.U.CM))&&b.hammer.off(b.event)};a.U.pO=function(b){var c=f(b.selector);a.U.EF(c);var d=a.U.vF(b);a.U.NW(b,d,!1);a.U.VW(b);c.trigger("ojclose",b);f.removeData(c[0],a.U.$p)};a.U.XV=function(b,c,d){var g=f(b);(c=!!c)&&a.U.Cm(g)&&a.U.zk(b,!1);g.toggleClass(a.U.G6[d],!c)};a.U.pha=function(b){var c=b.query;
if(null!==c){var d=b.selector,c=window.matchMedia(c),g=a.U.uV(b);b=function(b){a.U.XV(d,b.matches,g)};c.addListener(b);a.U.XV(d,c.matches,g);f.data(f(d)[0],a.U.ZC,{mqList:c,mqListener:b})}};o_("OffcanvasUtils.setupResponsive",a.U.pha,a);a.U.yha=function(b){b=f(b.selector);var c=f.data(b[0],a.U.ZC);c&&(c.mqList.removeListener(c.mqListener),f.removeData(b[0],a.U.ZC))};o_("OffcanvasUtils.tearDownResponsive",a.U.yha,a);a.U.open=function(b){var c=f(b.selector),d=f.data(c[0],a.U.$p);if(d){if(d._closePromise)return d._closePromise;
if(d._openPromise)return d._openPromise}var d=new Promise(function(d,e){a.j.Va(c,jQuery);var g=a.U.uV(b),m=f.Event("ojbeforeopen");c.trigger(m,b);if(!1===m.result)e("ojbeforeopen veto");else{var n,m=b.displayMode,q=a.U.vF(b);a.j.Va(q,jQuery);var p=f.extend({},b);f.data(c[0],a.U.$p,p);a.U.NW(p,q,!0);"start"==g||"end"==g?(n=void 0===n?c.outerWidth(!0)+"px":n,"push"==m&&a.U.vda(q,g,n)):(n=void 0===n?c.outerHeight(!0)+"px":n,"push"==m&&a.U.wda(q,g,n));window.setTimeout(function(){var b=a.U.IR(c);a.j.Va(b,
jQuery);b.addClass(a.U.VR(g))},0);a.U.fU(q,function(){q.removeClass("oj-offcanvas-transition");a.bd.ew(c[0]);c.trigger("ojopen",p);a.U.cca(p);d(!0)})}}),g=f.data(c[0],a.U.$p);g&&(g._openPromise=d);return d};o_("OffcanvasUtils.open",a.U.open,a);a.U.close=function(b){return a.U.zk(b.selector,!0)};o_("OffcanvasUtils.close",a.U.close,a);a.U.zk=function(b,c){var d=f(b);a.j.Va(d,jQuery);var g=f.data(d[0],a.U.$p);if(g&&g._closePromise)return g._closePromise;var h=new Promise(function(h,l){if(a.U.Cm(d)){b!=
g.selector&&h(!0);var m=a.U.EF(d),n=g.displayMode,m=a.U.VR(m),q=a.U.IR(d);a.j.Va(q,jQuery);q.hasClass(m)||h(!0);var p=f.Event("ojbeforeclose");d.trigger(p,g);!1===p.result?l("beforeClose veto"):(p=a.U.vF(g),c&&a.U.fU(p,function(){a.U.pO(g);h(!0)}),"push"==n&&a.U.iI(p,""),q.removeClass(m),c?p.addClass("oj-offcanvas-transition"):(a.U.pO(g),h(!0)))}else h(!0)});(g=f.data(d[0],a.U.$p))&&(g._closePromise=h);return h};a.U.toggle=function(b){var c=f(b.selector);a.j.Va(c,jQuery);return a.U.Cm(c)?a.U.close(b):
a.U.open(b)};o_("OffcanvasUtils.toggle",a.U.toggle,a)});