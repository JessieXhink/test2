/**
 * Copyright (c) 2014, Oracle and/or its affiliates.
 * All rights reserved.
 */
"use strict";
define(['./DvtToolkit', './DvtBaseTreeView'], function(dvt) {
  // Internal use only.  All APIs and functionality are subject to change at any time.
    // Map the D namespace to dvt, which is used to provide access across partitions.
  var D = dvt;
  D.PC=function(a,b){this.Init(b===D.p?"sunburstRotationInput":"sunburstRotation");this.Id=a%360};(0,D.ca)("DvtSunburstRotationEvent",D.PC);D.y.q(D.PC,D.$j,"DvtSunburstRotationEvent");D.PC.TYPE="sunburstRotation";D.PC.TYPE_INPUT="sunburstRotationInput";D.PC.prototype.Bqa=(0,D.w)("Id");D.PC.prototype.getStartAngle=D.PC.prototype.Bqa;
D.vR=function(a,b,c){this.Init(a,b,c)};(0,D.ca)("DvtSunburst",D.vR);D.y.q(D.vR,D.wR,"DvtSunburst");D.vR.newInstance=function(a,b,c){return new D.vR(a,b,c)};D.x=D.vR.prototype;D.x.Init=function(a,b,c){D.vR.u.Init.call(this,a,b,c);this.If=new D.xR;this.Xd=2*window.Math.PI};
D.x.mM=function(a){D.vR.u.mM.call(this,a);a=this.A();this.mna=(0,D.dk)()?"url("+a._resources.rotateCursor+"), auto":"url("+a._resources.rotateCursor+") 8 8, auto";this.Id=(360-a.startAngle)*D.yR/360;this.Id>window.Math.PI&&(this.Id-=D.yR);"auto"==a.animationOnDisplay&&(a.animationOnDisplay="fan")};
D.x.Ep=function(a){var b=window.Math.max(window.Math.ceil(3*window.Math.min(a.e,a.g)/400),2);a.x+=b;a.y+=b;a.e-=2*b;a.g-=2*b;(0,D.zR)(this,a);this.Hb=D.AR.U(this,a,this.OW);this.coa=window.Math.floor(window.Math.min(a.e,a.g)/2);this.Sa&&D.BR.Bq(this.coa,this.Sa,this.Id,this.Xd,this.A().sorting)};
D.x.sj=function(a,b){(0,D.CR)(this,a);this.Jm&&a.k(this.Jm);this.Hb&&(a.k(this.Hb),this.Hb=D.o);this.GK=new D.H(b.x+b.e/2,b.y+b.g/2);if("off"!=this.A().rotation&&(0,D.DR)(this)){var c=(0,D.Ze)()?60:15,c=new D.dp(this.j(),b.x+b.e/2,b.y+b.g/2,this.coa+c);(0,D.Aj)(c);c.setCursor(this.mna);a.k(c);this.Aa().Ba(c,new D.ER(D.o,"_rotationShape"))}c=new D.C(this.j());(0,D.N)(c,this.GK.x,this.GK.y);a.k(c);if((0,D.DR)(this)){var d=new D.C(this.j());c.k(d);this.Sa.U(d);(0,D.FR)(this,this.Sa);this.hx=new D.C(this.j());
c.k(this.hx);this.Sja=new D.C(this.j());c.k(this.Sja)}else(0,D.GR)(this,a)};D.x.CH=function(a,b,c,d){return new D.HR(a,b,c,d)};D.x.R0=function(a,b){if("fan"===this.A().animationOnDisplay&&(0,D.DR)(this)){this.e3(0);var c=new D.yo(this.j(),this,this.wH);(0,D.S)(c.P,"typeNumber",this,this.nxa,this.e3,2*window.Math.PI);return c}return D.vR.u.R0.call(this,a,b)};D.x.Q0=function(){var a=D.vR.u.Q0.call(this);a&&(0,D.N)(a,this.GK.x,this.GK.y);return a};
D.x.Rq=function(){if(!this.a0){this.da.Sk();var a=new D.B(0,0,this.fb,this.tb);this.Ep(a);this.sj(this.da,a);for(var a=this.fc?this.fc.getSelection():[],b=0;b<a.length;b++)a[b].zb(D.k)}this.Xd<2*window.Math.PI&&this.e3(2*window.Math.PI);D.vR.u.Rq.call(this)};D.x.jU=function(a){this.hx.k(a);!(0,D.Cr)()&&!(0,D.xk)()&&((0,D.hA)(this.hx),(0,D.Yp)(this.hx,D.IR))};D.x.nxa=(0,D.w)("Xd");D.x.e3=function(a){this.Xd=a;this.Ep(new D.B(0,0,this.fb,this.tb));this.Sa&&(0,D.JR)(this.Sa,D.k)};
D.KR=function(a,b){a.B4=b;a.iK=new D.D(a.j(),0,0,a.fb,a.tb);(0,D.Aj)(a.iK);a.iK.setCursor(a.mna);a.k(a.iK);a.Aa().Ba(a.iK,new D.ER(D.o,"_rotationShape"))};D.LR=function(a,b){var c=b-a.B4;a.B4=b;a.Id+=c;a.Id<-window.Math.PI?a.Id+=2*window.Math.PI:a.Id>window.Math.PI&&(a.Id-=2*window.Math.PI);a.Ep(new D.B(0,0,a.fb,a.tb));a.Sa&&(0,D.JR)(a.Sa,D.k);a.Wa(new D.PC(360-window.Math.round(180*a.Id/window.Math.PI),D.p))};
D.MR=function(a){a.B4=D.o;a.removeChild(a.iK);a.iK=D.o;var b=360-window.Math.round(180*a.Id/window.Math.PI);a.Wa(new D.PC(b,D.p));a.Wa(new D.PC(b,D.k))};D.NR=function(a,b,c){return window.Math.atan2(c-a.GK.y,b-a.GK.x)};D.vR.prototype.Lj=function(){return(0,D.Zl)(this.A(),"componentName","DvtUtilBundle","SUNBURST")};D.vR.prototype.bZ=(0,D.ba)("DvtSunburstBundle");D.vR.prototype.Ap=function(a){return new D.OR(this,a)};
D.OR=function(a,b){this.Init(a,b);var c=this.N.A().nodeDefaults;this.lr=b.labelDisplay?b.labelDisplay:c.labelDisplay;this.vJ=b.labelHalign?b.labelHalign:c.labelHalign;this.Pn=b.radius};D.y.q(D.OR,D.VR,"DvtSunburstNode");D.yR=2*window.Math.PI;
D.OR.prototype.U=function(a){if(this.Yy){this.cX=a;this.J=this.y4();a.k(this.J);var b=(0,D.WR)(this);if(!this.lg&&(0==this.Xj&&this.Xd==D.yR)&&b){var c=window.Math.sqrt(2),d=this.bj*c-4;this.Db=-this.bj/c+2;this.Zb=-this.bj/c+2;var c=this.A()._cf,e=this.N.Rc;e.dr=c;0<d&&0<d&&((0,D.bh)(e,d),(0,D.ch)(e,d),e.qf((0,D.XR)(this)),this.n4=b=D.Fe.hH(e,b,this.J),c=b.I(),(0,D.N)(b,this.Db+(d-c.e)/2,this.Zb+(d-c.g)/2))}else this.Ob=this.YN(this.J),this.Ob!=D.o&&(this.J.k(this.Ob),this.xr&&(c=this.Ob.Lb(),this.Ar=
new D.D(this.N.j(),c.x,c.y,c.e,c.g),this.Ar.ra("#FFFFFF"),this.Ar.ua(D.p),this.J.k(this.Ar),d=this.Ob.Da(),(0,D.tF)(d)||this.Ar.Ga(d),this.J.k(this.Ob)));this.J.xd("img");this.Nl();this.Lx(a)}};D.OR.prototype.zb=function(a){D.OR.u.zb.call(this,a);this.Ha()?(this.J.zb(D.k),this.N.jU(this.J)):(this.J.zb(D.p),this.cX&&this.cX.k(this.J))};D.OR.prototype.Sb=function(){this.J&&this.Yy&&(this.J.Sb(),this.Ha()?this.N.jU(this.J):this.N.Sja.k(this.J))};
D.OR.prototype.Jb=function(){this.J&&(this.Yy&&!this.Nc())&&(this.J.Jb(),!this.Ha()&&this.cX&&this.cX.k(this.J))};D.SR=function(a){return"insert"==a.ME||"insertAndReplace"==a.ME};
D.OR.prototype.Td=function(a){var b,c,d,e;if(a.type==D.$e)return D.OR.u.Td.call(this,a);b=a.keyCode;if(32==b&&a.ctrlKey)return this;for(e=this;e.lg;)e=e.lg;c=(0,D.YR)(this,e,(0,D.ZR)(this));a:{for(d=0;d<c.length;d++)if(this===c[d])break a;d=-1}var f=this.Id+this.Xd/2,f=(0,D.$R)(f);switch(b){case 38:if(this===e||180<f){if(b=this.MW)if(c=b.Id+b.Xd/2,c=(0,D.$R)(c),180<c)return b;a=(0,D.Vn)(this,a,(0,D.aS)(this))}else a=(0,D.bS)(this);break;case 40:if(this===e||0<=f&&180>=f){if(b=this.MW)if(c=b.Id+b.Xd/
2,c=(0,D.$R)(c),0<=c&&180>=c)return b;a=(0,D.Vn)(this,a,(0,D.aS)(this))}else a=(0,D.bS)(this);break;case 37:a=1==c.length?this:0==d?c[c.length-1]:c[d-1];break;case 39:a=1==c.length?this:d==c.length-1?c[0]:c[d+1];break;default:a=this}(0,D.cS)(a);return a};D.bS=function(a){var b=a.lg;b&&(a=b,(0,D.cS)(b));(0,D.cS)(a);return a};D.$R=function(a){a=D.eh.TL(a);0>a?a+=360:360<a&&(a-=360);return a};D.x=D.OR.prototype;
D.x.Ze=function(){if(this.J){var a=this.J.I(),b=new D.H(a.x,a.y),b=(0,D.Df)(this.J,b);a.x=b.x;a.y=b.y;return a}return new D.B(0,0,0,0)};D.x.Ej=function(){return this.J?this.J.Fa():D.o};D.x.XQ=function(){return(0,D.Df)(this.J,(0,D.dS)(0.5*(this.bj+this.Xj),this.Id+this.Xd/2))};D.x.CS=function(a,b,c,d){this.Xj=a;this.bj=b;this.Id=c;this.Xd=d;this.Yy=D.k};D.x.JH=function(){return this.sI?(0,D.kp)():D.OR.u.JH.call(this)};
D.x.wm=function(a){var b=D.J.ue(this.Tj),c=D.J.qe(this.Tj),d=D.J.pe(this.Tj),e=this.Id;a&&!(0,window.isNaN)(a[2])&&(a=a[2],a-this.Id>window.Math.PI?e+=D.yR:this.Id-a>window.Math.PI&&(e-=D.yR));return[this.Xj,this.bj,e,this.Xd,b,c,d]};D.x.Tq=function(a){this.CS(a[0],a[1],a[2],a[3]);this.Tj=D.J.eD(window.Math.round(a[4]),window.Math.round(a[5]),window.Math.round(a[6]));(0,D.JR)(this,D.p)};D.x.xf=function(a,b){b.Yy&&0<b.Xd?D.OR.u.xf.call(this,a,b):this.Pg(a)};
D.x.contains=function(a,b){var c=(0,D.eS)(a,b);return window.Math.sqrt(a*a+b*b)>=this.Xj&&window.Math.sqrt(a*a+b*b)<=this.bj&&(0,D.fS)(this,c)};D.fS=function(a,b){for(;b<a.Id;)b+=D.yR;for(;b-a.Id>D.yR;)b-=D.yR;return b>=a.Id&&b<=a.Id+a.Xd};D.dS=function(a,b){return{x:window.Math.cos(b)*a,y:window.Math.sin(b)*a}};D.eS=function(a,b){var c=window.Math.atan2(b,a);0>c?c+=D.yR:c>D.yR&&(c-=D.yR);return c};
D.OR.prototype.y4=function(){if(!this.Xd||0>=this.Xd)return D.o;var a=(0,D.gS)(this),a=new D.Ei(this.N.j(),a);this.N.Aa().Ba(a,this);a.F(this.la());a.O(this.JH());var b=this.N.A().nodeDefaults;a.ea(new D.Wg(b.borderColor,0.3));a.Jq(new D.Wg(b.hoverColor,1,3));a.Kq(new D.Wg(b.selectedInnerColor,1,1.5),new D.Wg(b.selectedOuterColor,1,3.5));a.Ur(new D.Wg(b.hoverColor,1,3));a.rg(this.bb());this.sI&&(a.F(0.001),a.ua(D.p));return a};
D.gS=function(a){var b,c,d,e;a.Xd<D.yR?(b=(0,D.dS)(a.bj,a.Id),c=(0,D.dS)(a.bj,a.Id+a.Xd),d=(0,D.dS)(a.Xj,a.Id+a.Xd),e=(0,D.dS)(a.Xj,a.Id),b=D.K.moveTo(b.x,b.y)+D.K.arcTo(a.bj,a.bj,a.Xd,1,c.x,c.y)+D.K.lineTo(d.x,d.y)+D.K.arcTo(a.Xj,a.Xj,a.Xd,0,e.x,e.y)+D.K.closePath()):(b=(0,D.dS)(a.bj,a.Id),c=(0,D.dS)(a.bj,a.Id+a.Xd/2),d=(0,D.dS)(a.Xj,a.Id),e=(0,D.dS)(a.Xj,a.Id+a.Xd/2),b=D.K.moveTo(b.x,b.y)+D.K.arcTo(a.bj,a.bj,a.Xd/2,1,c.x,c.y)+D.K.arcTo(a.bj,a.bj,a.Xd/2,1,b.x,b.y),0<a.Xj&&(b+=D.K.moveTo(e.x,e.y)+
D.K.arcTo(a.Xj,a.Xj,a.Xd/2,0,d.x,d.y)+D.K.arcTo(a.Xj,a.Xj,a.Xd/2,0,e.x,e.y)),b+=D.K.closePath());return b};
D.OR.prototype.YN=function(a){if(!this.rC||(!a||!this.lr||"off"==this.lr)||this==this.N.Sa&&this.Xd<D.yR)return D.o;var b=D.p;if("auto"==this.lr){if(b=!(0,D.dk)())(0,D.lG)(),b="Windows"==D.eG;b=b?D.p:D.k}else"rotated"==this.lr&&(b=D.k);if(b&&this.Xd<this.N.Xd){var c=window.Math.max(this.Xj,10),d=this.bj-c-6,e=1.1*this.Xd*(c+6);if(6>=e)a=D.o;else if(b=new D.lg(this.N.j(),this.rC,0,0),b.qf((0,D.XR)(this)),(0,D.hS)(this,b),D.yf.wc(b,d,e,a)){d=(c+this.bj)/2;if("inner"==this.vJ||"outer"==this.vJ)a.k(b),
a=b.I().e,"inner"==this.vJ?d=c+4.5+a/2:"outer"==this.vJ&&(d=this.bj-4.5-a/2);a=(0,D.dS)(d,this.Id+this.Xd/2);b.Ff();b.Xf();c=this.Id+this.Xd/2;c=c>=D.yR?c-D.yR:c;c=0>c?c+D.yR:c;c>0.5*window.Math.PI&&c<1.5*window.Math.PI&&(c+=window.Math.PI);b.Ij(c);(0,D.N)(b,a.x,a.y);b.ua(D.p);a=b}else a=D.o}else{if(0==this.Xj)b={x:0,y:0};else if(b=(0,D.dS)((this.Xj+this.bj)/2,this.Id+this.Xd/2),c=3*(0,D.XR)(this)/2,d=(0,D.eS)(b.x+c/2,b.y),!(0,D.fS)(this,(0,D.eS)(b.x-c/2,b.y))||!(0,D.fS)(this,d))b=D.o;if(b){c=new D.lg(this.N.j(),
this.rC,b.x,b.y,D.o);c.qf((0,D.XR)(this));(0,D.hS)(this,c);c.Ff();c.Xf();c.ua(D.p);for(var d=D.yf.pj(c),f=e=b.x,g=b.y-d.g/2,h=b.y+d.g/2;this.contains(e,g)&&this.contains(e,h);)e--;for(;this.contains(f,g)&&this.contains(f,h);)f++;e+=3;f-=3;b=2*window.Math.min(b.x-e,f-b.x);b<d.e&&(c.ja((e+f)/2),b=f-e);a=D.yf.wc(c,b,d.g,a)?c:D.o}else a=D.i}return a};
D.OR.prototype.Xz=function(){if(!this.jd){var a;a=this.J;var b=this.mb();if(!a||!(0,D.SR)(this)||!this.De()&&b)a=D.o;else{if(b)var b=this.N.j(),c=this.N.A()._resources,d=new D.sf(b,c.collapse,0,0,16,16),e=new D.sf(b,c.collapseOver,0,0,16,16),c=new D.sf(b,c.collapseDown,0,0,16,16);else b=this.N.j(),c=this.N.A()._resources,d=new D.sf(b,c.expand,0,0,16,16),e=new D.sf(b,c.expandOver,0,0,16,16),c=new D.sf(b,c.expandDown,0,0,16,16);(0,D.Aj)(d);(0,D.Aj)(e);(0,D.Aj)(c);b=new D.ef(b,d,e,c);b.oa(D.$e,this.g$,
D.p,this);d=(0,D.dS)(this.bj,this.Id+this.Xd/2);(0,D.N)(b,d.x-8,d.y-8);a.k(b);a=(0,D.M)("DvtUtilBundle",this.mb()?"COLLAPSE":"EXPAND");this.N.Aa().Ba(b,new D.ER(this,this.getId(),a));a=b}this.jd=a}D.OR.u.Xz.call(this)};D.OR.prototype.Dt=function(){this.jd&&this.J&&(this.J.removeChild(this.jd),this.jd=D.o);D.OR.u.Dt.call(this)};
D.JR=function(a,b){if(a.J){var c=(0,D.gS)(a);a.J.Hj(c);if(a.lg||!(0==a.Xj&&a.Xd==D.yR))a.Ob&&a.J.removeChild(a.Ob),a.Ob=a.YN(a.J),a.Ar&&(a.J.removeChild(a.Ar),a.Ar=D.o);a.J.O(a.JH());if(b)for(var c=a.Mc(),d=0;d<c.length;d++)(0,D.JR)(c[d],D.k)}};
D.OR.prototype.g$=function(a){this.ef(!this.mb());var b=this.N,c=this.mb(),d=this.getId();b.nP=d;c?(c=this.A(),c.nodes&&0<c.nodes.length&&b.U(b.A()),b.Wa(new D.TR("sunburstExpand",this.getId()))):(b.U(b.A()),b.Wa(new D.TR("sunburstCollapse",this.getId())));this.Nl();a.stopPropagation()};D.UR=function(a){return a.Pn!=D.o?(0,window.Number)(a.Pn):a.lg?1:a.sI?0.25:(0,D.WR)(a)?1:0.5};
D.OR.prototype.mc=function(){var a=[];this.bb()&&a.push((0,D.M)("DvtUtilBundle",this.Ha()?"STATE_SELECTED":"STATE_UNSELECTED"));(0,D.SR)(this)&&a.push((0,D.M)("DvtUtilBundle",this.mb()?"STATE_EXPANDED":"STATE_COLLAPSED"));return(0,D.ql)(this.fd(),a)};D.OR.prototype.Nl=function(){!(0,D.Cf)()&&this.J&&this.J.Wb("label",this.mc())};D.OR.prototype.kv=function(){var a=D.OR.u.kv.call(this);a.radius=(0,D.UR)(this);return a};
D.BR={};D.y.q(D.BR,D.y,"DvtSunburstLayout");D.BR.Bq=function(a,b,c,d,e){var f=D.BR.qha(b);D.BR.jf(a/f,b,c,d,e,0)};D.BR.jf=function(a,b,c,d,e,f){var g=f+(0,D.UR)(b)*a;b.CS(f,g,c,d);f=b.Mc();if(f!=D.o&&b.mb()){"on"==e&&(f=f.slice(0),f.sort(function(a,b){return b.ad()-a.ad()}));(0,D.F)(b.N.j())&&(f=f.slice(0).reverse());var h=0;for(b=0;b<f.length;b++)h+=0<f[b].ad()?f[b].ad():0;for(b=0;b<f.length;b++){var j=f[b];if(!(0>=j.ad())){var l=j.ad()/h*d;D.BR.jf(a,j,c,l,e,g);c+=l}}}};
D.BR.qha=function(a){var b=0,c=a.Mc();if(c&&0<c.length){for(var d=0;d<c.length;d++)var e=D.BR.qha(c[d]),b=window.Math.max(b,e);return b+(0,D.UR)(a)}return(0,D.UR)(a)};
D.TR=function(a,b){this.Init(a);this.jb=b?b:D.o};D.y.q(D.TR,D.$j,"DvtSunburstExpandCollapseEvent");D.TR.prototype.getId=(0,D.w)("jb");
D.HR=function(a,b,c,d){D.RR.call(this,a,b,c,d)};D.y.q(D.HR,D.RR,"DvtSunburstEventManager");D.x=D.HR.prototype;D.x.Ll=function(a){var b=this.za(a.target);b&&b.getId&&"_rotationShape"==b.getId()&&!this.MU?(this.MU=D.k,a=(0,D.qv)(this.Y,a.pageX,a.pageY),b=this.N,(0,D.KR)(b,(0,D.NR)(b,a.x,a.y))):D.HR.u.Ll.call(this,a)};D.x.ks=function(a){if(this.MU){a=(0,D.qv)(this.Y,a.pageX,a.pageY);var b=this.N;(0,D.LR)(b,(0,D.NR)(b,a.x,a.y))}else D.HR.u.ks.call(this,a)};
D.x.yn=function(a){this.MU?(this.MU=D.p,(0,D.MR)(this.N)):D.HR.u.yn.call(this,a)};D.x.rj=function(a){var b=D.k,c=a.keyCode,d=this.Jd(),e=this.N;(0,D.SR)(d)&&((0,D.Qn)(a)&&!d.mb()||(0,D.Rn)(a)&&d.mb()||a.ctrlKey&&13==c)?(d.g$(),(0,D.ji)(a)):e&&"off"!=e.A().rotation&&(37==c||39==c)&&!a.ctrlKey&&a.altKey&&a.shiftKey?(c=37==c?-5*(window.Math.PI/180):5*(window.Math.PI/180),(0,D.KR)(e,0),(0,D.LR)(e,c),(0,D.MR)(e),(0,D.ji)(a)):b=D.HR.u.rj.call(this,a);return b};
D.x.NH=function(a){var b=this.za(a.target);b&&(b.getId&&"_rotationShape"==b.getId())&&(0,D.sv)(a,this.Uua,this)};D.x.nT=function(a){(0,D.tv)(this.xc,a,"rotateKey")};D.x.mT=function(a){(0,D.vv)(this.xc,a,"rotateKey")};D.x.Uua=function(a,b){if(1>=(0,D.wv)(this.xc,"rotateKey").length){(0,D.xv)(this.xc,b.identifier,"rotateKey","rotateKey","rotateKey",this.Tua,this.Sua,this);(0,D.In)(this.xc,b.identifier,D.p);var c=(0,D.qv)(this.Y,b.pageX,b.pageY),d=this.N;(0,D.KR)(d,(0,D.NR)(d,c.x,c.y));a.vC()}};
D.x.Tua=function(a,b){var c=(0,D.qv)(this.Y,b.pageX,b.pageY),d=this.N;(0,D.LR)(d,(0,D.NR)(d,c.x,c.y));a.preventDefault()};D.x.Sua=function(){(0,D.MR)(this.N)};
(0,D.Bh)("DvtSunburstBundle",{COLOR:"Color",OTHER:"Other",SIZE:"Size"});
D.xR=function(){this.Init({skyros:D.PR,alta:{}})};D.y.q(D.xR,D.QR,"DvtSunburstDefaults");D.PR={nodeDefaults:{borderColor:"#FFFFFF",hoverColor:"#FFFFFF",labelDisplay:"auto",labelHalign:"center",selectedInnerColor:"#FFFFFF",selectedOuterColor:"#000000"},rotation:"on",startAngle:90};
  return D;
});