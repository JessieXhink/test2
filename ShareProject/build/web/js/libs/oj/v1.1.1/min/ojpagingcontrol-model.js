/**
 * Copyright (c) 2014, 2015, Oracle and/or its affiliates.
 * All rights reserved.
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","knockout","ojs/ojpagingcontrol","ojs/ojknockout-model"],function(a,f,d){a.tb=function(a){this.Ea=a;this.current=0;this.Init();this.mf=[];this.gI(10)};o_("CollectionPagingDataSource",a.tb,a);a.b.ga(a.tb,a.Mg,"oj.CollectionPagingDataSource");a.tb.prototype.Init=function(){a.tb.q.Init.call(this)};a.b.i("CollectionPagingDataSource.prototype.Init",{Init:a.tb.prototype.Init});a.tb.prototype.dG=function(){return this.Fu()?this.kl:this.totalSize()-this.current};a.tb.prototype.Wo=
function(){this.mf=Array(this.dG());var a=this;return this.Ea.Pp(this.current,this.current+this.mf.length).then(function(c){for(var d=0;d<c.length;d++)a.mf[d]=c[d];a.qv();a.Ai=a.aa+a.mf.length-1})};a.tb.prototype.qv=function(){if(void 0!==this.aj){this.aj.removeAll();for(var b=0;b<this.mf.length;b++)this.aj.push(a.Ha.map(this.mf[b]))}};a.tb.prototype.tl=function(){return this.mf};a.b.i("CollectionPagingDataSource.prototype.getWindow",{tl:a.tb.prototype.tl});a.tb.prototype.qw=function(){void 0===this.aj&&
(this.aj=d.observableArray(),this.qv());return this.aj};a.b.i("CollectionPagingDataSource.prototype.getWindowObservable",{qw:a.tb.prototype.qw});a.tb.prototype.getPage=function(){return this.Jc};a.b.i("CollectionPagingDataSource.prototype.getPage",{getPage:a.tb.prototype.getPage});a.tb.prototype.setPage=function(b,c){c=c||{};b=parseInt(b,10);try{a.tb.q.handleEvent.call(this,a.gc.J.BEFOREPAGE,{page:b,previousPage:this.Jc})}catch(d){return Promise.reject(null)}this.pageSize=null!=c.pageSize?c.pageSize:
this.pageSize;c.startIndex=b*this.pageSize;var f=this.Jc;this.Jc=b;this.aa=c.startIndex;var h=this;return new Promise(function(b,d){h.ee(c).then(function(){a.tb.q.handleEvent.call(h,a.gc.J.PAGE,{page:h.Jc,previousPage:f});b(null)},function(){h.Jc=f;h.aa=h.Jc*h.pageSize;d(null)})})};a.b.i("CollectionPagingDataSource.prototype.setPage",{setPage:a.tb.prototype.setPage});a.tb.prototype.getStartItemIndex=function(){return this.aa};a.b.i("CollectionPagingDataSource.prototype.getStartItemIndex",{getStartItemIndex:a.tb.prototype.getStartItemIndex});
a.tb.prototype.getEndItemIndex=function(){return this.Ai};a.b.i("CollectionPagingDataSource.prototype.getEndItemIndex",{getEndItemIndex:a.tb.prototype.getEndItemIndex});a.tb.prototype.getPageCount=function(){var a=this.totalSize();return-1==a?-1:Math.ceil(a/this.pageSize)};a.b.i("CollectionPagingDataSource.prototype.getPageCount",{getPageCount:a.tb.prototype.getPageCount});a.tb.prototype.fetch=function(a){var c=a||{};if(void 0!==c.pageSize&&void 0!==c.startIndex){if(!this.Fu())return this.hA(null),
Promise.resolve();this.kl=c.startIndex+c.pageSize;var d=this;return this.Wo().then(function(){d.hA(null)})}return this.ee(a)};a.b.i("CollectionPagingDataSource.prototype.fetch",{fetch:a.tb.prototype.fetch});a.tb.prototype.ee=function(a){var c=a||{};void 0!==c.startIndex&&(this.current=c.startIndex);void 0!==c.pageSize&&(this.kl=this.pageSize=c.pageSize);var d=this;return new Promise(function(a){try{d.Ea.fetch({success:function(){d.Wo().then(function(){d.hA(c);a({data:d.tl(),startIndex:d.current})})}})}catch(b){d.Wo().then(function(){d.hA(c);
a({data:d.tl(),startIndex:d.current})})}})};a.tb.prototype.hA=function(a){a=a||{};a.silent||this.handleEvent("sync",{data:this.tl(),startIndex:this.current});a.success&&a.success()};a.tb.prototype.handleEvent=function(b,c){return a.tb.q.handleEvent.call(this,b,c)};a.tb.prototype.Fu=function(){return this.current+this.kl<this.totalSize()};a.tb.prototype.gI=function(a){this.kl=this.pageSize=a};a.tb.prototype.size=function(){var a=this.tl();return a?a.length:0};a.b.i("CollectionPagingDataSource.prototype.size",
{size:a.tb.prototype.size});a.tb.prototype.totalSize=function(){return this.Ea.length};a.b.i("CollectionPagingDataSource.prototype.totalSize",{totalSize:a.tb.prototype.totalSize});a.Lb=function(a){this.data=a;this.current=0;this.Init();this.gI(10)};o_("ArrayPagingDataSource",a.Lb,a);a.b.ga(a.Lb,a.Mg,"oj.ArrayPagingDataSource");a.Lb.prototype.Init=function(){a.Lb.q.Init.call(this)};a.b.i("ArrayPagingDataSource.prototype.Init",{Init:a.Lb.prototype.Init});a.Lb.prototype.dG=function(){return this.Fu()?
this.kl:this.totalSize()-this.current};a.Lb.prototype.Wo=function(a){a=a||{};this.mf=Array(this.dG());for(var c=0;c<this.mf.length;c++)this.mf[c]=this.data[this.current+c];this.qv();this.Ai=this.aa+this.mf.length-1;a.silent||this.handleEvent("sync",{data:this.mf,startIndex:this.current})};a.Lb.prototype.qv=function(){if(void 0!==this.aj){this.aj.removeAll();for(var a=0;a<this.mf.length;a++)this.aj.push(this.mf[a])}};a.Lb.prototype.handleEvent=function(b,c){return a.Lb.q.handleEvent.call(this,b,c)};
a.Lb.prototype.tl=function(){return this.mf};a.b.i("ArrayPagingDataSource.prototype.getWindow",{tl:a.Lb.prototype.tl});a.Lb.prototype.qw=function(){void 0===this.aj&&(this.aj=d.observableArray(),this.qv());return this.aj};a.b.i("ArrayPagingDataSource.prototype.getWindowObservable",{qw:a.Lb.prototype.qw});a.Lb.prototype.getPage=function(){return this.Jc};a.b.i("ArrayPagingDataSource.prototype.getPage",{getPage:a.Lb.prototype.getPage});a.Lb.prototype.setPage=function(b,c){c=c||{};b=parseInt(b,10);try{a.Lb.q.handleEvent.call(this,
a.gc.J.BEFOREPAGE,{page:b,previousPage:this.Jc})}catch(d){return Promise.reject(null)}this.pageSize=null!=c.pageSize?c.pageSize:this.pageSize;c.startIndex=b*this.pageSize;var f=this.Jc;this.Jc=b;this.aa=c.startIndex;var h=this;return new Promise(function(b,d){h.ee(c).then(function(){a.Lb.q.handleEvent.call(h,a.gc.J.PAGE,{page:h.Jc,previousPage:f});b(null)},function(){h.Jc=f;h.aa=h.Jc*h.pageSize;d(null)})})};a.b.i("ArrayPagingDataSource.prototype.setPage",{setPage:a.Lb.prototype.setPage});a.Lb.prototype.getStartItemIndex=
function(){return this.aa};a.b.i("ArrayPagingDataSource.prototype.getStartItemIndex",{getStartItemIndex:a.Lb.prototype.getStartItemIndex});a.Lb.prototype.getEndItemIndex=function(){return this.Ai};a.b.i("ArrayPagingDataSource.prototype.getEndItemIndex",{getEndItemIndex:a.Lb.prototype.getEndItemIndex});a.Lb.prototype.getPageCount=function(){var a=this.totalSize();return-1==a?-1:Math.ceil(a/this.pageSize)};a.b.i("ArrayPagingDataSource.prototype.getPageCount",{getPageCount:a.Lb.prototype.getPageCount});
a.Lb.prototype.fetch=function(a){a=a||{};if(void 0!==a.pageSize&&void 0!==a.startIndex){if(!this.Fu())return Promise.resolve();this.kl=a.startIndex+a.pageSize}this.Wo(null);return Promise.resolve()};a.b.i("ArrayPagingDataSource.prototype.fetch",{fetch:a.Lb.prototype.fetch});a.Lb.prototype.ee=function(a){var c=a||{};void 0!==c.startIndex&&(this.current=c.startIndex);void 0!==c.pageSize&&(this.kl=this.pageSize=c.pageSize);this.Wo(a);return Promise.resolve({data:this.mf,startIndex:this.current})};a.Lb.prototype.Fu=
function(){return this.current+this.kl<this.totalSize()};a.Lb.prototype.gI=function(a){this.kl=this.pageSize=a;this.Wo(null)};a.Lb.prototype.totalSize=function(){return this.data.length}});